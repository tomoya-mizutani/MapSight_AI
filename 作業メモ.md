# task note

## 2025/05/15

### 開発環境の構築

14:45 ~ 15:19
・ChatGPTでのプロジェクト仕様の調査検討
・プロジェクトフォルダの構築
・開発環境（主にVim）の調査検討

### 　開発環境の構築の続き　+　画像抽出の自動化

18:06:05 ~　19:00
開発環境の構築
主にモジュールのダウンロードとインストールでむっちゃ時間を喰った．20分ぐらいはかかったと思う．

19:00~20:33:14
画像抽出プログラムの試作，
ＵＲＬリンクから動画を取得し，そこから画像抽出するプログラムを作成，スクリプトも書いたのでコマンドでの実行が可能に！
これまで処理に時間がかかっている．結構限界かも...
clean_same_framesも実行に時間がかかっている．
大量おデータ処理が開発に置けるネックになるなぁ

取り敢えず待機画面の部分の削除はできた．4000軒ほどのデータ削除
よくわからんが高速化もできたみたい．

- clean_same_frames.py：MD5 → dHash → pHash → aHash と改良
- 並列処理＋削除ログ付き

## 2025/05/16

### 開発環境構築の続き・Github連携

13:35 ~ 14:38
git管理の導入．Github連携でつまずいている．
Dataは.gitignoreで連携無効にしているよ
連携は次はSSH接続を試すつもり

### 　Github連携・SSH接続

15:25 ~ 15:53
取り敢えず今はパスなし鍵で運用する．
今後システムを公開するようなことがあれば（誰か他の人に使ってもらうようなことがあれば）切り替えする．
sshpassだったりssh_agentの活用といったことを検討する．

SSH接続が完了した．

新しいリポジトリをcloneするときは SSHURLで取得する  
git clone <git@github.com>:username/SomeRepo.git  

リポジトリをHTTPSでcloneしてしまった場合⇒  
git-remote set-url-origin <git@github.com>:... でSSH　URLに変更  

16:00 ~ 16:47
github actionsとprojectの設定  
使えるようにした．  
今後作業に関してSlackに通知を出すとかが出来るようになるかも  

github actionsでbug.yaml/task.yaml/log.yaml　を実装するのがタスクとして残った．次の開発はこれ．

19:55 ~ 20:04
ISSUE＿TEMPLATE内の*.yamlを記述．プッシュ　　
これにより新しい実装・調査，日時メモ・記録，バグ記録が出来るようになった？
ISSUEの立て方に悩んだら安野さんの都知事戦の時の公開ISSUEみたいな奴を参考にしよう
[安野たかひろ，課題提起マニュアル（政策レポジトリ）](https://manifest.takahiroanno.com/manual_issue/)

## 2025/05/18

## [Task]マッチ単位でのフレーム分割に取り組む

17:59~ 18:54
> [!IMPORTANT]
>作業開始するときは仮想環境を起動させてからやろうね
> 作業開始コマンド  
> wsl terminalを起動
> source ~/pubgmapenv/bin/activate  

実行ファイルはsrcフォルダに格納したので，また後で志度実行テストをするときにPath関連でエラーが起きるかも...

ファイル参照と分類はできた．
自動的な分類だと精度がダメダメ
ここをチューニングするのは大変そうなので，
参考画像として試合終了時のフレームを与え，テンプレートマッチでの実装を次のタスクとして残して，今回の作業は終了．

試合区切り分類 - segment_rounds.py：
 ・aHash で類似度列 → ハミング距離ピーク
 ・テンプレートマッチで「試合終了」検出
 ・クラスタ統合 (--cluster-gap) & フレーム間引き (--step)

## [Task]segment_rounds.pyにおける依存関係の解消 #6

pip install の実行
requirement.txtへの追記を行った．

## [Task]マッチ単位でのフレーム分割part2

19:20 ~ 19:37  
テンプレートを用いた分類を実装して，その実行まで行った．  
結構時間がかかりそうなので休憩に入る．  
多分長くて２０分ってところかな

ISSUEも1つ追加しておいた．

## 2025/05/19

### [Task]マッチ単位でのフレーム分割 part3

14:25　~ 15:00
前回に続きフレーム分割に取り組む．
前回のテストでテンプレート画像とのマッチングは確認出来たので，それを用いたグループ分けの取り組みになるな．
テンプレートと同じ画像が数枚連続しているから，それを消去するかどこかに吸収させないといけない．
境界探索には実行に15分程度かかる

実行時間の間は技術調査というかお勉強をします...
同一画像検知アルゴリズムのお勉強を...

今回は取り敢えず動かしたいのでahashを採用します．

## 2025/05/20

### [Task]マッチ単位でのフレーム分割の続き

14:43~
hdist関数の追加，detect_template_frames()のNumPy配列への対応．

15:09~ 15:11:
テスト
実装ミス（スペルミス）が発覚，修正
誤）unit8 正）uint8

15:11~ 15:33
実行テスト　あまりに長いので途中で止めた．
軽量化を試しながら．．
なんか問題としてcv2が上手くインポートできていないような気もするけど...
opencvはちゃんとインストールできているからなぁ．．．よくわからん．

軽量化を試す．
テンプレート検出も並列に実行指せる．クラスタ代表だけ採用

segment_rounds.pyに--stepオプション追加

16:01
もろもろ修正を加えて，実行テスト

やっぱり環境が悪さしてそう．
仮想環境の構築からやり直しか？？？

## 2025/05/23

### [frames取得時のフレームレートの設定](https://github.com/tomoya-mizutani/MapSight_AI/issues/9)

16:00 ~ 16:10
FPSの値を0.5に変更した．
2秒に一回マップ状況を取得するように変更した．

### [仮想環境の構築 #10](https://github.com/tomoya-mizutani/MapSight_AI/issues/10)

16:39 ~ 16:41

プロジェクト直下に.venvを新規追加．
前回のドキュメントを読んでた．．．

18:47 ~　19:22
Pylanceとの相性の悪さを解決したい．．．
Docker等の導入を考えているが，なかなかうまくいかない

## 2025/05/24

### [仮想環境の構築](https://github.com/tomoya-mizutani/MapSight_AI/issues/1)  

00:19
Vscodeのwsl接続をDocker-DeskTopからUbuntuに明示的に変更する．
ということでWSL:Ubuntuで開発出来ることになった．
なんか拡張機能の追加をまたしないといけないような気がする．．．．
![UbuntuのWSL環境への接続成功！！！](sreenshot/connect_wsl.png)

VScodeのインタープリターがpubgmapenvになっていなかったぽい．
インタープリターを仮想環境に設定しなおしておいた．

問題の部分にもモジュールの解決できないというやつはなくなった．

00:50~ 01:30  
実行テスト，実行できた！！！！
終わったタイミングを見逃したから，気付いたタイミングが30分だっ

#### ドキュメント作成

10:22 ~ 10:24
仮想環境の構築について  
1.WSL接続先をDockerDeskTopからUbuntuに変更  
2.Pythonインタープリターを手動で再設定  

これによってちゃんとPylanceもvenvを参照してくれるようになった  

### ISSUEの追加

Detectigve_templateの最適化ですです．

### [Segment_Rounds.pyにおける速度改善](https://github.com/tomoya-mizutani/MapSight_AI/issues/11)

12:00 ~ 12:17
実行テスト
まぁ実行時間が半分ぐらいになったのは良いね．
並列処理の導入した．
あとは追加で実行時間計算ログ出力・CLI実行時の進捗表示も追加．
GPUは取り敢えず今は断念．本番環境では導入したい．

## [framesのトリミング自動化](https://github.com/tomoya-mizutani/MapSight_AI/issues/7)

22:52 ~ 23:42
map配信の中から必要な部分のみを抽出．
切り抜き箇所はconfig.yamlを参照．
crop_minimap.pyが実行ソースコード
少しだけパスとかそこら辺を修正して実行テストに移る．

23:02 ~  23:24
実行テスト
15977/15977 [22:30<00:00, 11.83it/s]
Done: 15977 images

実行に22分もかかってしまってはいるが，まぁ良いだろう...
取り敢えずは実行できたし...
実行コマンド:python src/crop_minimap.py

crop_minimap.pyにドキュメントを追加した．
後はコードリーディングを行い，処理の流れを追った．
おわり！！

## タスク整理

11:40 ~ 00:09
タスク整理を行った．
Github Project の活用とISSUEの追加を行った．
Logも残してみた．

## [ディレクトリ構造図の作成](https://github.com/tomoya-mizutani/MapSight_AI/issues/16)

22:03 ~ 23:01
Issue#16に取り組む．
README.mdにディレクトリ構造図を追加

拡張機能:Markdown Preview Mermaid Supportを追加  

結局Mermaidは使わずにAscii artでやることにした．  
Github Actions Workflowを用いたCI/CDを取り入れる  
treeコマンドでASCII treeをREADME.mdに自動更新を欠ける形にした.  
.github/workflows/update-tree.ymlに記述  
git push 実行時にgithub Actionsが動いて自動更新かかる．  

git fetch origin
git rebase origin/main  
が必要な時もある.  

> [!IMPORTANT]
>作業開始するときに自動更新のせいでgitのバージョンがずれている可能性がある．
> そういう時は以下のコマンドを実行して作業開始
> git fetch origin #最新のリモートをフェッチ
> git rebase origin/main #リモートのmainブランチをローカルにリベース

## 2025/05/26

### [画像学習・予測モデルの調査](https://github.com/tomoya-mizutani/MapSight_AI/issues/4)

調査内容は[survey.md](./survey.md#画像学習予測モデルの調査)　に記述
どういった予測モデルが使えるか・システム全体の構想を考える．
何をどうやって学習するか・予測するかを考えないといけない．
参考事例として，サッカーでの予測モデルを取り上げている．
