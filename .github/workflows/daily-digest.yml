name: Daily Digest
on:
  schedule:
    # GitHub cron ã¯ UTCã€‚JST 12:00 = UTC 03:00
    - cron: '0 3 * * *'
  workflow_dispatch: {}            # æ‰‹å‹•å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚‚ä»˜ã‘ã‚‹

jobs:
  digest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const OWNER = context.repo.owner;
            const REPO  = context.repo.repo;
            // â¶ 24 æ™‚é–“ä»¥å†…ã«æ›´æ–°ã®ã‚ã£ãŸ Issue / PR ã‚’æ¤œç´¢
            const since = new Date(Date.now() - 24*3600*1000).toISOString();
            const q = `repo:${OWNER}/${REPO} updated:>${since}`;
            const res = await github.rest.search.issuesAndPullRequests({ q, per_page: 100 });
            if (res.data.items.length === 0) return;  // å¤‰åŒ–ãªã—ãªã‚‰çµ‚äº†
            // â· ç®‡æ¡æ›¸ãã¸å¤‰æ›
            const body = res.data.items
              .map(i => `- [#${i.number}](${i.html_url}) ${i.title}`)
              .join('\n');
            // â¸ â€œlogâ€ ç”¨å›ºå®š Issue (ä¾‹ #1) ã«ã‚³ãƒ¡ãƒ³ãƒˆè¿½è¨˜
            await github.rest.issues.createComment({
              owner: OWNER,
              repo: REPO,
              issue_number: 1,      // â† log Issue ç•ªå·ã«åˆã‚ã›ã¦å¤‰æ›´
              body: `### ğŸ”” Daily Digest (${new Date().toLocaleDateString('ja-JP')})\n${body}`
            });
