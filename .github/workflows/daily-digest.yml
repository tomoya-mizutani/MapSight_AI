name: Update directory tree

on:
  push:
    paths:
      - '**'
  workflow_dispatch:

jobs:
  gen-tree:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Generate full-depth directory tree
        run: |
          {
            echo '<!-- DIR-START -->'
            echo '```'
            # -a: éš ã—ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å«ã‚ã‚‹ã€--dirsfirst: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå„ªå…ˆ
            tree --charset ascii -a --dirsfirst .
            echo '```'
            echo '<!-- DIR-END -->'
          } > TREE.md

      - name: Inject tree into README
        run: |
          # README.md ã® DIR-STARTã€œDIR-END ã‚’ä¸¸ã”ã¨å…¥ã‚Œæ›¿ãˆ
          sed -e '/<!-- DIR-START -->/,/<!-- DIR-END -->/d' README.md \
            | sed '/## ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ å›³/r TREE.md' \
            > README.new.md
          mv README.new.md README.md

      - name: Commit & Push if changed
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: chore: update directory tree
          file_pattern: README.md
